<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Meta tags for character set and viewport -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Title of the webpage -->
  <title>Bookings</title>
  <!-- Link to external CSS files -->
  <link rel="stylesheet" href="css/fonts.css">
  <link rel="stylesheet" href="css/dashboard.css">
  <!-- Link to favicon -->
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
</head>

<body>
  
  <section class="all-bookings">
    
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/superadmin"><h1 style="color: black;">Users</h1></a>
      </div>
      <div class="search">
        <input type="text" name="search" placeholder="Search">
        <i class="fa-solid fa-magnifying-glass"></i>
      </div>
    </div>
    <div id="all-bookings-list">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Username</th>
            <th>Email</th>
            <th>Phone No</th>
            <th>DOB</th>
            <th>Role</th>
            
          </tr>
        </thead>
        <tbody>
          <% users.forEach(user => { 
            if (user && user.role !== 'superuser') { %>
            <tr>
              <td><%= user.fullname %></td>
              <td><%= user.username %></td>
              <td><%= user.email %></td>
              <td><%= user.phone %></td>
              <td><%= new Date(user.dob).toDateString() %></td>
              <td><%= user.role %></td>
              <td><button class="btn edit">update</button></td>
              <div class="modal hidden">
                <form action="/updateUserRole" method="post">
                  <input type="hidden" name="userId" value="<%= user._id %>">
                  <select name="newRole">
                    <option value="superuser" <%= user.role === 'superuser' ? 'selected' : '' %>>superuser</option>
                    <option value="user" <%= user.role === 'user' ? 'selected' : '' %>>user</option>
                  </select>
                  <button class="btn updatebtn" type="submit">Update Role</button>
                </form>
                <td>
                  <form action="/deletingUser" method="post">
                    <input type="hidden" name="userId" value="<%= user._id %>">
                    <button type="submit" class="btn deletebtn">Delete</button>
                  </form>
                </td>
                
                </td>
              </div>
              

               
              </td>
             
            </tr>
             <% } else { %>
              <tr>
              <td><%= user.fullname %></td>
              <td><%= user.username %></td>
              <td><%= user.email %></td>
              <td><%= user.phone %></td>
              <td><%= new Date(user.dob).toDateString() %></td>
              <td><%= user.role %></td>
              </tr>
            <% }}); %>
        </tbody>
      </table>
    </div>
  </section>
  <div class="overlay hidden">
  </div>

  <script>
    // Select all edit buttons and modals
    const overlay = document.querySelector('.overlay');
    const editBtns = document.querySelectorAll('.edit');
    const modals = document.querySelectorAll('.modal');
    // const table = document.querySelector('table');
    // Add event listener to each edit button
    editBtns.forEach((btn, index) => {
        btn.addEventListener('click', function() {
            // Toggle the visibility of the corresponding modal
            modals[index].classList.toggle('hidden');
            overlay.classList.toggle('hidden');
            
        });
    });

    // Close modals when clicking outside
    document.body.addEventListener('click', function(event) {
        if (!event.target.classList.contains('edit') && !event.target.closest('.modal')) {
            modals.forEach(modal => {
                modal.classList.add('hidden');
                overlay.classList.add('hidden');
            });
        }
    });
</script>
  
 
 
  <script src="https://kit.fontawesome.com/5050694ff5.js" crossorigin="anonymous"></script>
  
</body>

</html>